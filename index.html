<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pao Form</title>
  <style>
    .error-message {
      color: red;
      font-size: 12px;
      margin-top: 4px;
    }
  </style>
</head>
<body>

  <form id="myForm">
    <label for="personalName">Personal Name:</label>
    <input type="text" id="personalName" name="personalName">
    <div id="personalNameError" class="error-message"></div>

    <label for="personalEmail">Personal Email:</label>
    <input type="email" id="personalEmail" name="personalEmail">
    <div id="personalEmailError" class="error-message"></div>

    <div id="address">
      <label for="city">City:</label>
      <input type="text" id="city" name="city">
      <div id="cityError" class="error-message"></div>

      <label for="zipcode">Zipcode:</label>
      <input type="text" id="zipcode" name="zipcode">
      <div id="zipcodeError" class="error-message"></div>

      <label for="country">Country:</label>
      <select id="country" name="country">
        <option value="us">United States</option>
        <option value="ca">Canada</option>
        <option value="uk">United Kingdom</option>
      </select>
      <div id="countryError" class="error-message"></div>
    </div>

    <div id="emails">
      <label>Emails:</label>
      <div id="emailsArrayError" class="error-message"></div>
      <div id="emailsArray">
        <!-- FormArray for emails with multiple controls -->
      </div>
      <button type="button" id="addEmail">Add Email</button>
    </div>

    <button type="submit">Submit</button>
  </form>

  <script type="module">
      import { FormGroup, FormControl, FormArray } from './index'
      const Validators = {
        required: {
          validator: (value) => !!value,
          errorMessage: 'This field is required.',
        },
        email: {
          validator: (value) => /\S+@\S+\.\S+/.test(value),
          errorMessage: 'Invalid email address.',
        },
        validCountry: {
          validator: (value) => value == 'us',
          errorMessage: 'Invalid country!'
        }
      };

      const form = new FormGroup();

      form.addControl('personalName', '', [Validators.required]);
      form.addControl('personalEmail', '', [Validators.required, Validators.email]);

      const addressGroup = new FormGroup();
      addressGroup.addControl('city', '', [Validators.required]);
      addressGroup.addControl('zipcode', '', [Validators.required]);
      addressGroup.addControl('country', 'us', [Validators.required, Validators.validCountry]);

      form.addGroup('address', addressGroup);

      // FormArray for emails with multiple controls
      const emailsArray = new FormArray();
      form.addFormArray('emails', emailsArray);

      document.getElementById('addEmail').addEventListener('click', () => {

        const emailInput = document.createElement('input');
        let uniqId = `email${emailsArray.controls.length}`;
        emailInput.type = 'email';
        emailInput.id = uniqId;
        emailInput.name = uniqId;
        emailInput.placeholder = 'Enter email';
        document.getElementById('emailsArray').appendChild(emailInput);

        const emailInputError = document.createElement('div');
        emailInputError.id = uniqId;
        emailInputError.className = 'error-message';
        document.getElementById('emailsArray').appendChild(emailInputError);

        // of course document should b ready first
        const emailFormGroup = new FormGroup();
        emailFormGroup.addControl(uniqId, '', [Validators.required, Validators.email]);

        emailsArray.push(emailFormGroup);

        // trigger validation
        form.validateAll();
        

      });


      //form.setControlValue('personalName', 'John Doe'); // value setter
      //form.validateControl('personalName') // will update value & error
      //form.validateAll()

      function submitForm(event) {
        event.preventDefault();
        form.validateAll();

        if (form.valid) {
          const formData = form.value;
          console.log('Form Data:', formData);
        } else {
          console.log('Form is not valid. Please correct the errors.');
        }
      }

      const formElement = document.getElementById('myForm');
      formElement.addEventListener('submit', submitForm);

      // Trigger validation on initial load for all form fields
      form.validateAll();
  </script>

</body>
</html>
